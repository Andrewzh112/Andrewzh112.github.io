<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>On-Policy Distillation Adventures</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>✦</text></svg>">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #fafaf9;
            --bg-secondary: #f5f5f4;
            --bg-card: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #444444;
            --text-muted: #737373;
            --border-light: #e5e5e5;
            --border-medium: #d4d4d4;
            --accent-ochre: #8b5a2b;
            --accent-warm: #525252;
            
            /* Editorial fonts */
            --font-headline: 'Playfair Display', 'Times New Roman', serif;
            --font-body: 'Source Serif 4', 'Georgia', serif;
            --font-sans: 'Inter', -apple-system, sans-serif;
            --font-mono: 'JetBrains Mono', 'Monaco', monospace;
        }

        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Source+Serif+4:ital,opsz,wght@0,8..60,400;0,8..60,500;0,8..60,600;1,8..60,400&family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-body);
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.7;
            font-size: 19px;
            overflow-x: hidden;
            font-weight: 400;
        }

        .main-wrapper { position: relative; }

        /* Sidebars */
        .sidebar-left {
            position: fixed;
            left: 0; top: 0;
            width: 280px; height: 100vh;
            background: var(--bg-color);
            border-right: 1px solid var(--border-light);
            padding: 3rem 2rem;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-right {
            position: fixed;
            right: 0; top: 0;
            width: 300px; height: 100vh;
            background: var(--bg-color);
            border-left: 1px solid var(--border-light);
            padding: 3rem 1.5rem;
            overflow-y: auto;
            z-index: 100;
        }

        .main-content {
            margin-left: 280px;
            margin-right: 300px;
            min-height: 100vh;
        }

        /* Sections */
        section {
            min-height: 85vh;
            padding: 5rem 4rem;
            position: relative;
            border-bottom: 1px solid var(--border-light);
        }
        section:last-child { border-bottom: none; }

        .section-number {
            font-family: var(--font-mono);
            font-size: 0.875rem;
            font-weight: 400;
            color: var(--accent-ochre);
            margin-bottom: 0.5rem;
            letter-spacing: 0.1em;
        }

        /* Hero - Editorial Style with Optional Cover Photo */
        .hero-section {
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            min-height: 100vh;
            position: relative;
        }

        /* Optional: Add hero-with-image class and set background-image for cover photo */
        .hero-with-image {
            min-height: 90vh;
            background-size: cover;
            background-position: center;
        }

        .hero-with-image::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(0,0,0,0.7));
        }

        .hero-with-image .hero-content { position: relative; z-index: 1; }
        .hero-with-image .hero-title,
        .hero-with-image .hero-subtitle { color: white; text-shadow: 0 2px 20px rgba(0,0,0,0.4); }
        .hero-with-image .authors-section { border-color: rgba(255,255,255,0.3); }
        .hero-with-image .authors-label,
        .hero-with-image .resources-label { color: rgba(255,255,255,0.8); }
        .hero-with-image .author-name,
        .hero-with-image .author-affiliation { color: white; }
        .hero-with-image .resource-icon { border-color: rgba(255,255,255,0.5); background: rgba(255,255,255,0.1); }
        .hero-with-image .resource-item { color: rgba(255,255,255,0.9); }
        .hero-with-image .resource-item:hover { color: white; }
        .hero-with-image .scroll-hint { color: rgba(255,255,255,0.7); }
        .hero-with-image .scroll-hint-arrow { border-color: rgba(255,255,255,0.4); }

        .hero-content { max-width: 800px; padding: 2rem; }

        .hero-title {
            font-family: var(--font-headline);
            font-size: 4.5rem;
            font-weight: 600;
            line-height: 1.05;
            margin-bottom: 1.25rem;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .hero-subtitle {
            font-family: var(--font-body);
            font-size: 1.5rem;
            color: var(--text-secondary);
            font-weight: 400;
            margin-bottom: 3rem;
            line-height: 1.6;
        }

        /* Authors */
        .authors-section {
            margin-bottom: 3rem;
            padding: 1.5rem 0;
            border-top: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
        }

        .authors-label {
            font-family: var(--font-sans);
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .authors-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 2.5rem;
        }

        .author { text-align: center; }

        .author-name {
            font-family: var(--font-headline);
            font-size: 1.625rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .author-name a {
            color: inherit;
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.3s;
            padding-bottom: 1px;
        }

        .author-name a:hover { border-bottom-color: var(--accent-ochre); }

        .author-affiliation {
            font-family: var(--font-sans);
            font-size: 0.875rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        /* Resources */
        .resources-section { margin-bottom: 2rem; }

        .resources-label {
            font-family: var(--font-sans);
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }

        .resources-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 2.5rem;
        }

        .resource-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-secondary);
            transition: all 0.3s;
        }

        .resource-item:hover { color: var(--accent-ochre); }
        .resource-item:hover .resource-icon { border-color: var(--accent-ochre); }

        .resource-icon {
            width: 56px; height: 56px;
            border: 1px solid var(--border-medium);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.75rem;
            transition: all 0.3s;
        }

        .resource-icon svg { width: 22px; height: 22px; opacity: 0.7; }
        .resource-label-text {
            font-family: var(--font-sans);
            font-size: 0.8125rem;
            font-weight: 400;
        }

        /* Left Sidebar */
        .sidebar-left h3 {
            font-family: var(--font-headline);
            font-size: 0.9375rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 2rem;
        }

        .toc-list { list-style: none; }
        .toc-list li { margin-bottom: 0.25rem; }

        .toc-list a {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
            padding: 0.5rem 0;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.9375rem;
            font-family: var(--font-sans);
            transition: all 0.25s;
            font-weight: 400;
            line-height: 1.4;
        }

        .toc-list a:hover { color: var(--text-secondary); }
        .toc-list a.active { color: var(--text-primary); font-weight: 500; }
        .toc-list a.active .toc-num { color: var(--accent-ochre); }

        .toc-num {
            font-family: var(--font-mono);
            font-size: 0.8125rem;
            color: var(--text-muted);
            min-width: 2rem;
            font-weight: 400;
        }

        .toc-subsection {
            padding-left: 1.5rem !important;
            font-size: 0.875rem !important;
        }
        .toc-subsection .toc-num { font-size: 0.75rem; min-width: 2.5rem; }

        /* Right Sidebar */
        .sidebar-right h3 {
            font-family: var(--font-headline);
            font-size: 0.9375rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 2rem;
        }

        .margin-note-container { position: relative; }

        .margin-note {
            font-family: var(--font-body);
            font-size: 0.9375rem;
            line-height: 1.7;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-light);
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .margin-note.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .margin-note:last-child { border-bottom: none; }

        .note-num {
            font-family: var(--font-mono);
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--accent-ochre);
            margin-right: 0.375rem;
        }

        .margin-note a {
            color: var(--accent-ochre);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.2s;
        }

        .margin-note a:hover { border-bottom-color: var(--accent-ochre); }

        .margin-note-empty {
            font-family: var(--font-body);
            font-size: 0.9375rem;
            color: var(--text-muted);
            font-style: italic;
            padding: 2rem 0;
        }

        /* Content */
        .section-header { margin-bottom: 3.5rem; }

        .section-header h2 {
            font-family: var(--font-headline);
            font-size: 3.25rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            letter-spacing: -0.01em;
            line-height: 1.15;
        }

        .section-header p {
            font-family: var(--font-body);
            font-size: 1.3125rem;
            color: var(--text-secondary);
            max-width: 640px;
            line-height: 1.65;
        }

        h3 {
            font-family: var(--font-headline);
            font-size: 2.25rem;
            font-weight: 600;
            margin: 2.5rem 0 1.125rem;
            color: var(--text-primary);
            letter-spacing: -0.01em;
        }

        h4 {
            font-family: var(--font-headline);
            font-size: 1.5rem;
            font-weight: 600;
            margin: 2rem 0 0.875rem;
            color: var(--text-primary);
        }

        p {
            margin-bottom: 1.5rem;
            max-width: 68ch;
        }

        .lead {
            font-family: var(--font-body);
            font-size: 1.375rem;
            line-height: 1.75;
            color: var(--text-secondary);
        }

        /* Subsection Numbering */
        .subsection-number {
            font-family: var(--font-mono);
            font-size: 0.9375rem;
            color: var(--accent-ochre);
            margin-right: 0.625rem;
            font-weight: 400;
        }

        /* Margin Markers */
        .margin-marker {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px; height: 18px;
            background: transparent;
            color: var(--accent-ochre);
            border: 1px solid var(--accent-ochre);
            border-radius: 50%;
            font-size: 0.625rem;
            font-weight: 500;
            text-decoration: none;
            margin-left: 0.15rem;
            vertical-align: super;
            cursor: pointer;
            transition: all 0.25s;
            font-family: var(--font-mono);
        }

        .margin-marker:hover {
            background: var(--accent-ochre);
            color: white;
        }

        /* Layout */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3.5rem;
            align-items: start;
        }

        .content-block { max-width: 100%; }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 2rem;
            margin: 1.75rem 0;
        }

        .card-highlight { border-left: 3px solid var(--accent-ochre); }

        /* Math */
        .math-block {
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            padding: 1.75rem;
            margin: 1.75rem 0;
            overflow-x: auto;
        }

        /* Interactive */
        .interactive-demo {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .slider-container { margin: 1.5rem 0; }

        .slider-container label {
            display: block;
            font-weight: 400;
            margin-bottom: 0.75rem;
            color: var(--text-secondary);
            font-size: 1rem;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            background: var(--border-light);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px; height: 18px;
            background: var(--accent-ochre);
            border-radius: 50%;
            cursor: pointer;
        }

        .metric-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .metric-box {
            text-align: center;
            padding: 1.125rem;
            background: var(--bg-secondary);
            border-radius: 6px;
        }

        .metric-value {
            font-family: var(--font-mono);
            font-size: 1.5rem;
            font-weight: 400;
            color: var(--accent-ochre);
        }

        .metric-label {
            font-family: var(--font-sans);
            font-size: 0.6875rem;
            color: var(--text-muted);
            margin-top: 0.375rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin: 1.75rem 0;
            border: 1px solid var(--border-light);
            border-radius: 6px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1rem;
        }

        th, td {
            padding: 1rem 1.375rem;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        th {
            background: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        tr:hover { background: rgba(120, 113, 108, 0.03); }
        .best { background: rgba(139, 90, 43, 0.08) !important; }

        /* Inline Code */
        code {
            font-family: var(--font-mono);
            font-size: 0.85em;
            background: var(--bg-secondary);
            padding: 0.15em 0.35em;
            border-radius: 3px;
            color: var(--text-primary);
        }

        /* Code Blocks - Fixed spacing */
        pre {
            background: #f8f8f8;
            border: 1px solid var(--border-light);
            border-radius: 4px;
            padding: 1rem 1.25rem;
            overflow-x: auto;
            font-size: 1rem;
            line-height: 1.6;
            margin: 1.25rem 0;
            font-family: var(--font-mono);
        }

        pre code {
            background: none;
            padding: 0;
            color: inherit;
            line-height: 1.6;
        }

        .code-keyword { color: #5c4033; font-weight: 600; }
        .code-string { color: #8b5a2b; }
        .code-comment { color: #737373; font-style: italic; }
        .code-function { color: #525252; }
        .code-number { color: #444; }
        .code-variable { color: #1a1a1a; }

        /* Charts */
        .chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.75rem 0;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.75rem;
        }

        /* BibTeX */
        .bibtex-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 1.75rem;
            margin-top: 3rem;
        }

        .bibtex-section h4 {
            margin-top: 0;
            margin-bottom: 1.25rem;
            font-size: 1.375rem;
        }

        .bibtex-section pre {
            margin: 0;
            background: var(--bg-card);
            padding: 1.25rem;
        }

        .copy-btn {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-medium);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.875rem;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.25s;
            font-weight: 400;
        }

        .copy-btn:hover {
            border-color: var(--accent-ochre);
            color: var(--accent-ochre);
        }

        /* Scroll hint - Elegant bouncing */
        .scroll-hint {
            position: absolute;
            bottom: 3.5rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .scroll-hint:hover {
            opacity: 0.7;
        }

        .scroll-hint-text {
            font-family: var(--font-sans);
            font-size: 0.6875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        .scroll-hint-arrow {
            width: 32px;
            height: 32px;
            border: 1px solid var(--border-medium);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: bounce 2s infinite;
        }

        .scroll-hint-arrow svg {
            width: 14px;
            height: 14px;
            opacity: 0.6;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(8px); }
            60% { transform: translateY(4px); }
        }

        /* Lists */
        ul {
            margin: 1.5rem 0;
            padding-left: 1.5rem;
            color: var(--text-secondary);
        }

        li { margin-bottom: 0.75rem; }

        /* Responsive */
        @media (max-width: 1400px) {
            .sidebar-right { display: none; }
            .main-content { margin-right: 0; }
            section { padding: 5rem 4rem; }
        }

        @media (max-width: 1024px) {
            .sidebar-left { display: none; }
            .main-content { margin-left: 0; }
            section { padding: 4rem 2.5rem; min-height: auto; }
            .content-grid { grid-template-columns: 1fr; }
            .chart-grid { grid-template-columns: 1fr; }
            .hero-title { font-size: 3rem; }
            body { font-size: 18px; }
        }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <!-- Left Sidebar -->
        <aside class="sidebar-left">
            <h3>Contents</h3>
            <ul class="toc-list">
                <li><a href="#hero" class="toc-link active"><span class="toc-num"></span>Introduction</a></li>
                <li><a href="#background" class="toc-link"><span class="toc-num">1</span>Background</a></li>
                <li><a href="#method" class="toc-link"><span class="toc-num">2</span>Method</a></li>
                <li><a href="#method-adaptive" class="toc-link toc-subsection"><span class="toc-num">2.1</span>Adaptive KL Control</a></li>
                <li><a href="#method-mixing" class="toc-link toc-subsection"><span class="toc-num">2.2</span>Mixing Strategies</a></li>
                <li><a href="#experiments" class="toc-link"><span class="toc-num">3</span>Experiments</a></li>
                <li><a href="#experiments-setup" class="toc-link toc-subsection"><span class="toc-num">3.1</span>Setup</a></li>
                <li><a href="#experiments-results" class="toc-link toc-subsection"><span class="toc-num">3.2</span>Results</a></li>
                <li><a href="#results" class="toc-link"><span class="toc-num">4</span>Key Results</a></li>
                <li><a href="#analysis" class="toc-link"><span class="toc-num">5</span>Analysis</a></li>
                <li><a href="#conclusion" class="toc-link"><span class="toc-num">6</span>Conclusion</a></li>
            </ul>
        </aside>

        <!-- Right Sidebar -->
        <aside class="sidebar-right">
            <h3>Footnotes</h3>
            <div class="margin-note-container" id="marginNoteContainer">
                <div class="margin-note-empty">Scroll to see footnotes...</div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Hero -->
            <!-- Add 'hero-with-image' class and set background-image in CSS for cover photo mode -->
            <section id="hero" class="hero-section">
                <div class="hero-content">
                    <h1 class="hero-title">On-Policy Distillation<br>Adventures</h1>
                    <p class="hero-subtitle">When you can't store the teacher's rollouts but still want the knowledge</p>
                    
                    <div class="authors-section">
                        <div class="authors-label">Authors</div>
                        <div class="authors-list">
                            <div class="author">
                                <div class="author-name">
                                    <a href="https://andrewzhao.com" target="_blank">Andrew Zhao</a>
                                </div>
                                <div class="author-affiliation">Independent Researcher</div>
                            </div>
                        </div>
                    </div>

                    <div class="resources-section">
                        <div class="resources-label">Resources</div>
                        <div class="resources-grid">
                            <a href="https://andrewzhao.com" class="resource-item" target="_blank">
                                <div class="resource-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                                </div>
                                <span class="resource-label-text">Website</span>
                            </a>
                            <a href="https://x.com/andrew_zhao" class="resource-item" target="_blank">
                                <div class="resource-icon">
                                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                </div>
                                <span class="resource-label-text">X</span>
                            </a>
                            <a href="#" class="resource-item">
                                <div class="resource-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                </div>
                                <span class="resource-label-text">Data</span>
                            </a>
                            <a href="#" class="resource-item">
                                <div class="resource-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect><rect x="9" y="9" width="6" height="6"></rect><line x1="9" y1="1" x2="9" y2="4"></line><line x1="15" y1="1" x2="15" y2="4"></line><line x1="9" y1="20" x2="9" y2="23"></line><line x1="15" y1="20" x2="15" y2="23"></line><line x1="20" y1="9" x2="23" y2="9"></line><line x1="20" y1="14" x2="23" y2="14"></line><line x1="1" y1="9" x2="4" y2="9"></line><line x1="1" y1="14" x2="4" y2="14"></line></svg>
                                </div>
                                <span class="resource-label-text">Model</span>
                            </a>
                            <a href="#" class="resource-item">
                                <div class="resource-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
                                </div>
                                <span class="resource-label-text">Code</span>
                            </a>
                            <a href="#" class="resource-item">
                                <div class="resource-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                                </div>
                                <span class="resource-label-text">arXiv</span>
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="scroll-hint" onclick="document.getElementById('background').scrollIntoView({behavior: 'smooth'})">
                    <span class="scroll-hint-text">Scroll</span>
                    <div class="scroll-hint-arrow">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                    </div>
                </div>
            </section>

            <!-- 1. Background -->
            <section id="background">
                <div class="section-header">
                    <div class="section-number">§ 1</div>
                    <h2>Background</h2>
                    <p>Understanding the fundamentals of policy distillation</p>
                </div>

                <div class="content-grid">
                    <div class="content-block">
                        <p class="lead">
                            Knowledge distillation compresses large language models into more efficient variants. Standard approaches rely on static datasets that become outdated as the student improves.
                        </p>

                        <p>
                            <strong>On-policy distillation</strong> takes a different approach<span class="margin-marker" data-note="1">1</span>. Rather than distilling from fixed teacher outputs, we generate new rollouts from the current student policy, enabling continuous adaptation. This is crucial in RLHF where reward model preferences evolve as the policy improves.
                        </p>

                        <p>
                            The key challenge is the KL divergence constraint<span class="margin-marker" data-note="2">2</span>. When training on-policy, student and teacher distributions can diverge rapidly, leading to instability. We need mechanisms to balance exploration with exploitation.
                        </p>
                    </div>

                    <div class="content-block">
                        <div class="card card-highlight">
                            <h4>Standard Distillation</h4>
                            <div class="math-block">
                                $$\mathcal{L}_{\text{distill}} = \mathbb{E}_{x \sim \mathcal{D}} \left[ D_{\text{KL}}\left( \pi_\theta(\cdot|x) \| \pi_{\text{teacher}}(\cdot|x) \right) \right]$$
                            </div>
                        </div>

                        <div class="card">
                            <h4>On-Policy Adaptation</h4>
                            <div class="math-block">
                                $$\mathcal{L}_{\text{on-policy}} = \mathbb{E}_{x \sim \pi_\theta} \left[ D_{\text{KL}}\left( \pi_\theta(\cdot|x) \| \pi_{\text{teacher}}(\cdot|x) \right) \right]$$
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. Method -->
            <section id="method">
                <div class="section-header">
                    <div class="section-number">§ 2</div>
                    <h2>Method</h2>
                    <p>Our approach to stable on-policy distillation</p>
                </div>

                <h3 id="method-adaptive">
                    <span class="subsection-number">2.1</span>Adaptive KL Control
                </h3>

                <p>
                    We introduce an adaptive mechanism adjusting the KL penalty based on training dynamics. Different phases require different levels of teacher guidance<span class="margin-marker" data-note="3">3</span>.
                </p>

                <p>
                    Early in training, we allow more deviation from the teacher to encourage exploration. As training progresses, we tighten the constraint to ensure stability.
                </p>

                <div class="card">
                    <h4>Implementation</h4>
                    <p style="font-size: 1rem; margin-bottom: 1rem;">
                        Our implementation<span class="margin-marker" data-note="4">4</span>:
                    </p>
                    <pre><code><span class="code-keyword">for</span> <span class="code-variable">batch</span> <span class="code-keyword">in</span> <span class="code-variable">dataloader</span>:
    <span class="code-comment"># Generate rollouts from current policy</span>
    <span class="code-variable">rollouts</span> = <span class="code-function">generate</span>(<span class="code-variable">student</span>, <span class="code-variable">batch</span>)
    
    <span class="code-keyword">with</span> <span class="code-variable">torch</span>.<span class="code-function">no_grad</span>():
        <span class="code-variable">teacher_logits</span> = <span class="code-variable">teacher</span>(<span class="code-variable">rollouts</span>)
    
    <span class="code-comment"># Compute KL-adaptive loss</span>
    <span class="code-variable">kl_div</span> = <span class="code-function">compute_kl</span>(<span class="code-variable">student_logits</span>, <span class="code-variable">teacher_logits</span>)
    <span class="code-variable">loss</span> = <span class="code-variable">task_loss</span> + <span class="code-function">β</span>(<span class="code-variable">t</span>) * <span class="code-variable">kl_div</span>
    
    <span class="code-variable">loss</span>.<span class="code-function">backward</span>()
    <span class="code-variable">optimizer</span>.<span class="code-function">step</span>()</code></pre>
                </div>

                <h3 id="method-mixing">
                    <span class="subsection-number">2.2</span>Mixing Strategies
                </h3>

                <div class="content-grid">
                    <div class="content-block">
                        <p>
                            The mixing ratio $\alpha$ controls the fraction of the batch from the current policy versus a replay buffer.
                        </p>

                        <p>
                            We explore a cosine annealing schedule that gradually shifts from off-policy to on-policy data as training progresses. This mirrors the natural evolution of the learning process.
                        </p>
                    </div>

                    <div class="content-block">
                        <div class="interactive-demo">
                            <h4 style="margin-top: 0;">Mixing Ratio Explorer</h4>
                            <div class="slider-container">
                                <label>On-Policy ($\alpha$): <span id="alphaValue">0.5</span></label>
                                <input type="range" id="alphaSlider" min="0" max="100" value="50">
                            </div>
                            <div class="metric-display">
                                <div class="metric-box">
                                    <div class="metric-value" id="stabilityMetric">0.72</div>
                                    <div class="metric-label">Stability</div>
                                </div>
                                <div class="metric-box">
                                    <div class="metric-value" id="convergenceMetric">0.85</div>
                                    <div class="metric-label">Convergence</div>
                                </div>
                                <div class="metric-box">
                                    <div class="metric-value" id="efficiencyMetric">0.63</div>
                                    <div class="metric-label">Efficiency</div>
                                </div>
                            </div>
                        </div>

                        <script>
                            const slider = document.getElementById('alphaSlider');
                            const alphaValue = document.getElementById('alphaValue');
                            const stabilityMetric = document.getElementById('stabilityMetric');
                            const convergenceMetric = document.getElementById('convergenceMetric');
                            const efficiencyMetric = document.getElementById('efficiencyMetric');

                            slider.addEventListener('input', (e) => {
                                const alpha = e.target.value / 100;
                                alphaValue.textContent = alpha.toFixed(2);
                                
                                const stability = 0.5 + 0.4 * (1 - alpha) + 0.1 * Math.sin(alpha * Math.PI);
                                const convergence = 0.6 + 0.3 * alpha + 0.1 * Math.sin(alpha * Math.PI * 2);
                                const efficiency = 0.4 + 0.5 * alpha * (1 - alpha) * 4;
                                
                                stabilityMetric.textContent = stability.toFixed(2);
                                convergenceMetric.textContent = convergence.toFixed(2);
                                efficiencyMetric.textContent = efficiency.toFixed(2);
                            });
                        </script>
                    </div>
                </div>
            </section>

            <!-- 3. Experiments -->
            <section id="experiments">
                <div class="section-header">
                    <div class="section-number">§ 3</div>
                    <h2>Experiments</h2>
                    <p>Evaluating on-policy distillation</p>
                </div>

                <h3 id="experiments-setup">
                    <span class="subsection-number">3.1</span>Setup
                </h3>

                <p>
                    We evaluate on GSM8K<span class="margin-marker" data-note="5">5</span> and HumanEval. Base models range from 1B to 7B parameters, with teachers 3-4× larger.
                </p>

                <p>
                    All experiments use vLLM<span class="margin-marker" data-note="6">6</span> for efficient trajectory generation. Training runs for 3 epochs with batch size 128 and learning rate 2e-5.
                </p>

                <h3 id="experiments-results">
                    <span class="subsection-number">3.2</span>Results
                </h3>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Method</th>
                                <th>GSM8K</th>
                                <th>HumanEval</th>
                                <th>Stability</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Standard</td>
                                <td>62.3</td>
                                <td>41.2</td>
                                <td>High</td>
                            </tr>
                            <tr>
                                <td>Pure On-Policy</td>
                                <td>58.7</td>
                                <td>38.9</td>
                                <td>Low</td>
                            </tr>
                            <tr class="best">
                                <td>Adaptive (Ours)</td>
                                <td>67.8</td>
                                <td>45.6</td>
                                <td>High</td>
                            </tr>
                            <tr>
                                <td>Fixed 50/50</td>
                                <td>64.1</td>
                                <td>42.8</td>
                                <td>Medium</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="chart-grid">
                    <div class="chart-container">
                        <h4>Performance vs Teacher Size</h4>
                        <canvas id="oracleChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4>Training Dynamics</h4>
                        <canvas id="trainingChart"></canvas>
                    </div>
                </div>

                <script>
                    new Chart(document.getElementById('oracleChart'), {
                        type: 'bar',
                        data: {
                            labels: ['1B', '3B', '7B', '13B', '70B'],
                            datasets: [{
                                label: 'GSM8K',
                                data: [45.2, 58.7, 67.8, 71.3, 73.1],
                                backgroundColor: 'rgba(120, 113, 108, 0.7)',
                                borderColor: 'rgba(120, 113, 108, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: { beginAtZero: true, max: 100, title: { display: true, text: 'Accuracy (%)' } }
                            }
                        }
                    });

                    new Chart(document.getElementById('trainingChart'), {
                        type: 'line',
                        data: {
                            labels: ['0', '200', '400', '600', '800', '1000'],
                            datasets: [{
                                label: 'Reward',
                                data: [0.42, 0.51, 0.58, 0.63, 0.66, 0.678],
                                borderColor: 'rgba(120, 113, 108, 1)',
                                backgroundColor: 'rgba(120, 113, 108, 0.1)',
                                yAxisID: 'y'
                            }, {
                                label: 'KL',
                                data: [0.0, 0.12, 0.18, 0.15, 0.11, 0.08],
                                borderColor: 'rgba(139, 90, 43, 1)',
                                backgroundColor: 'rgba(139, 90, 43, 0.1)',
                                yAxisID: 'y1'
                            }]
                        },
                        options: {
                            responsive: true,
                            interaction: { mode: 'index', intersect: false },
                            scales: {
                                x: { title: { display: true, text: 'Steps (×100)' } },
                                y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Reward' } },
                                y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'KL' }, grid: { drawOnChartArea: false } }
                            }
                        }
                    });
                </script>
            </section>

            <!-- 4. Results -->
            <section id="results">
                <div class="section-header">
                    <div class="section-number">§ 4</div>
                    <h2>Key Results</h2>
                    <p>What we learned</p>
                </div>

                <div class="content-grid">
                    <div class="content-block">
                        <h3>Findings</h3>
                        <p>
                            Our experiments reveal several insights<span class="margin-marker" data-note="7">7</span>:
                        </p>
                        
                        <ul>
                            <li><strong>Adaptive mixing is crucial</strong>: Fixed ratios underperform compared to dynamic schedules.</li>
                            <li><strong>Teacher size plateaus</strong>: Gains diminish beyond 7B teachers for 1B students.</li>
                            <li><strong>Stability requires tuning</strong>: Pure on-policy training often diverges.</li>
                            <li><strong>Efficiency trade-offs</strong>: On-policy adds ~30% overhead but improves performance 5-8%.</li>
                        </ul>
                    </div>

                    <div class="content-block">
                        <div class="card card-highlight">
                            <h4>Best Configuration</h4>
                            <table style="margin: 0; font-size: 0.9375rem;">
                                <tr><td style="padding: 0.5rem 0; color: var(--text-muted);">Schedule</td><td style="text-align: right;">Cosine</td></tr>
                                <tr><td style="padding: 0.5rem 0; color: var(--text-muted);">Initial $\alpha$</td><td style="text-align: right;">0.3</td></tr>
                                <tr><td style="padding: 0.5rem 0; color: var(--text-muted);">Final $\alpha$</td><td style="text-align: right;">0.7</td></tr>
                                <tr><td style="padding: 0.5rem 0; color: var(--text-muted);">KL Coeff</td><td style="text-align: right;">0.1 → 0.05</td></tr>
                                <tr><td style="padding: 0.5rem 0; color: var(--text-muted);">Buffer</td><td style="text-align: right;">10K</td></tr>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 5. Analysis -->
            <section id="analysis">
                <div class="section-header">
                    <div class="section-number">§ 5</div>
                    <h2>Analysis</h2>
                    <p>Training dynamics</p>
                </div>

                <h3>Why Adaptive Mixing Works</h3>
                <p>
                    Adaptive mixing relates to the exploration-exploitation trade-off<span class="margin-marker" data-note="8">8</span>. Early in training, the student benefits from more off-policy data. As the policy improves, on-policy data becomes more representative.
                </p>

                <div class="math-block">
                    $$\alpha(t) = \alpha_{\min} + (\alpha_{\max} - \alpha_{\min}) \cdot \frac{1}{2}\left(1 + \cos\left(\frac{t}{T}\pi\right)\right)$$
                </div>

                <p>
                    This cosine schedule transitions from exploration ($\alpha_{\min}$) to exploitation ($\alpha_{\max}$), matching the learning curve of policy optimization.
                </p>
            </section>

            <!-- 6. Conclusion -->
            <section id="conclusion">
                <div class="section-header">
                    <div class="section-number">§ 6</div>
                    <h2>Conclusion</h2>
                    <p>Summary and future work</p>
                </div>

                <p class="lead">
                    On-policy distillation offers a middle ground between standard knowledge distillation and full online learning. By adaptively mixing on-policy and off-policy data, we achieve better performance while maintaining stability.
                </p>

                <h3>Future Work</h3>
                <ul>
                    <li><strong>Multi-teacher distillation</strong>: Combining multiple teachers.</li>
                    <li><strong>Curriculum mixing</strong>: Scheduling by task difficulty.</li>
                    <li><strong>Memory-efficient buffers</strong>: Compressed representations.</li>
                    <li><strong>Theoretical bounds</strong>: Formal bias-variance analysis.</li>
                </ul>

                <!-- BibTeX -->
                <div class="bibtex-section">
                    <h4>Citation</h4>
                    <pre><code><span class="code-keyword">@article</span>{<span class="code-variable">zhao2024opd</span>,
  <span class="code-variable">title</span> = {<span class="code-string">On-Policy Distillation Adventures</span>},
  <span class="code-variable">author</span> = {<span class="code-string">Zhao, Andrew</span>},
  <span class="code-variable">journal</span> = {<span class="code-string">arXiv preprint</span>},
  <span class="code-variable">year</span> = {<span class="code-number">2024</span>},
  <span class="code-variable">url</span> = {<span class="code-string">https://andrewzhao.com/opd_adventures</span>}
}</code></pre>
                    <button class="copy-btn" onclick="copyBibtex()">Copy BibTeX</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Margin Notes -->
    <script>
        const marginNotesData = {
            1: { text: 'See <a href="https://arxiv.org/abs/2402.03828" target="_blank">Agarwal et al. (2024)</a> for policy gradient methods in RLHF.' },
            2: { text: 'The KL constraint was introduced by <a href="https://arxiv.org/abs/1909.08593" target="_blank">Schulman et al. (2017)</a> in TRPO.' },
            3: { text: 'The advantage estimate $\\hat{A}_t$ uses GAE with $\\lambda=0.95$.' },
            4: { text: 'Implementation based on <a href="https://github.com/huggingface/trl" target="_blank">TRL</a> with modifications.' },
            5: { text: 'GSM8K contains 8.5K grade school math problems requiring multi-step reasoning.' },
            6: { text: 'Experiments use <a href="https://github.com/vllm-project/vllm" target="_blank">vLLM</a> for trajectory generation.' },
            7: { text: 'Error bars show 95% confidence intervals from 3 runs with different seeds.' },
            8: { text: 'Analysis uses final 10% of training steps to ensure convergence.' }
        };

        let activeNotes = new Set();
        let noteElements = {};

        function initMarginNotes() {
            const container = document.getElementById('marginNoteContainer');
            Object.entries(marginNotesData).forEach(([id, data]) => {
                const noteEl = document.createElement('div');
                noteEl.className = 'margin-note';
                noteEl.dataset.noteId = id;
                noteEl.innerHTML = '<span class="note-num">' + id + '</span>' + data.text;
                container.appendChild(noteEl);
                noteElements[id] = noteEl;
            });
        }

        function updateVisibleNotes() {
            const container = document.getElementById('marginNoteContainer');
            if (activeNotes.size === 0) {
                container.innerHTML = '<div class="margin-note-empty">Scroll to see notes...</div>';
                return;
            }
            const sortedIds = Array.from(activeNotes).sort((a, b) => a - b);
            container.innerHTML = '';
            sortedIds.forEach(id => {
                const noteEl = noteElements[id].cloneNode(true);
                noteEl.classList.add('visible');
                container.appendChild(noteEl);
            });
            
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([container]);
            }
        }

        function copyBibtex() {
            const code = document.querySelector('.bibtex-section pre code');
            const text = code.innerText;
            navigator.clipboard.writeText(text);
            event.target.textContent = 'Copied';
            setTimeout(() => event.target.textContent = 'Copy BibTeX', 2000);
        }

        // TOC highlighting
        const sections = document.querySelectorAll('section, h3[id]');
        const tocLinks = document.querySelectorAll('.toc-link');

        const sectionObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute('id');
                    tocLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === '#' + id) {
                            link.classList.add('active');
                        }
                    });
                }
            });
        }, { rootMargin: '-40% 0px -40% 0px', threshold: 0 });

        sections.forEach(section => sectionObserver.observe(section));

        // Margin markers
        const markers = document.querySelectorAll('.margin-marker');
        
        const markerObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const noteId = entry.target.dataset.note;
                if (entry.isIntersecting) {
                    activeNotes.add(noteId);
                } else {
                    activeNotes.delete(noteId);
                }
                updateVisibleNotes();
            });
        }, { rootMargin: '-30% 0px -30% 0px', threshold: 0.5 });

        markers.forEach(marker => markerObserver.observe(marker));

        initMarginNotes();

        tocLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const target = document.getElementById(link.getAttribute('href').substring(1));
                if (target) target.scrollIntoView({ behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
